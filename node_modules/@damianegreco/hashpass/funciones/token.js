const jwt = require('jsonwebtoken');

const calcularSegundos = function(horas) {
  return (horas * 60 * 60) 
}

const generarToken = function(tokenSecret = "", expiracion = 6, datosUsuario = { usuario_id, usuario}){
  
  const token = jwt.sign({
    exp: Math.floor(Date.now() / 1000) + calcularSegundos(expiracion),
    data: datosUsuario
  }, tokenSecret);

  return (token);
}

const verificarToken = function(token = "", tokenSecret = ""){
  try {
    let datosUsuario = jwt.verify(token, tokenSecret);
    
    return (datosUsuario);
  } catch (error) { 
    if (error.name === 'JsonWebTokenError')
      return (`Error en token: ${error}`);
    else if (error.name === 'TokenExpiredError')
      return (`Token expirado: ${error.expiredAt}`);
    else
      return (`Error desconocido: ${error}`);
  }
}

module.exports = { generarToken, verificarToken }